"use strict";var mongoose=require("mongoose"),slugify=require("slugify"),tourSchema=new mongoose.Schema({name:{type:String,required:[!0,"A tour must have a name"],unique:!0,maxLength:[40,"A Tour name must have less or equal then 40 characters"],minLength:[10,"A Tour name must have more or equal then 10 characters"]},slug:{type:String},duration:{type:Number,required:[!0,"A tour must have a duration"]},maxGroupSize:{type:Number,required:[!0,"A tour must have a group size"]},difficulty:{type:String,required:[!0,"A tour must have a difficult"],enum:{values:["easy","medium","difficult"],message:"Difficulty should be: easy, medium or difficult"}},ratingsAverage:{type:Number,default:4.5,min:[1,"Rating must be above 1.0"],max:[5,"Rating must be below 5.0"],set:function(e){return Math.round(10*e)/10}},ratingsQuantity:{type:Number,default:0},price:{type:Number,required:[!0,"A tour must have a price"]},priceDiscound:{type:Number,validate:{validator:function(e){return e<this.price},message:"Discounted price can't be greater than the regular price"}},summary:{type:String,trim:!0},description:{type:String},imageCover:{type:String},images:[String],createdAt:{type:Date,default:Date.now,select:!1},startDates:[Date],secretTour:{type:Boolean,default:!1},startLocation:{type:{type:String,default:"Point",enum:["Point"]},coordinates:[Number],address:String,description:String},locations:[{type:{type:String,default:"Point",enum:["Point"]},coordinates:[Number],address:String,description:String,day:Number}],guides:[{type:mongoose.Schema.ObjectId,ref:"User"}]},{toJSON:{virtuals:!0},toObject:{virtuals:!0}});tourSchema.index({price:1,ratingsAverage:-1}),tourSchema.index({slug:1}),tourSchema.index({startLocation:"2dsphere"}),tourSchema.virtual("durationWeeks").get(function(){return this.duration/7}),tourSchema.virtual("review",{ref:"Review",foreignField:"tour",localField:"_id"}),tourSchema.pre("save",function(e){this.slug=slugify(this.name,{lower:!0}),e()}),tourSchema.pre("find",function(e){this.find({secretTour:{$ne:!0}}),e()}),tourSchema.pre(/^find/,function(e){this.find({secretTour:{$ne:!0}}),this.start=Date.now(),e()}),tourSchema.post(/^find/,function(e,t){console.log("Query took ".concat(Date.now()-this.start," milliseconds!")),console.log(e),t()}),tourSchema.pre(/^find/,function(e){this.populate({path:"guides",select:"-__v -passwordChangedAt"}),e()});var Tour=mongoose.model("Tour",tourSchema);module.exports=Tour;
//# sourceMappingURL=tourSchema.min.js.map
